## 文字の自動ツメ・アキ表示テスト

### 調査の概要／目的

写真3-1入る

　和文の組版処理では、一般的に句読点や全角カッコ類などの約物が連続する際には組版ソフト側の処理によって字間スペースの自動ツメ処理が行われ、字間が間延びして見えないように調整されている。

写真3-2入る

　また、和文の文中に欧文の文字列が挿入された際には自動でスペースの挿入処理が行われ、単語間の区切りをわかりやすくする。これらは通常、組版ソフト側の自動処理で当たり前のように行われ、組版作業者は気づきにくいが、日本語の可読性を上げるための縁の下の力持ち的な技術のひとつと言える。ただ、Webや電子書籍の世界では、日本のみを対象として展開してきた一部の電子書籍ストアアプリやVivliostyleのようなWeb規格の先行実装を実現しているアプリケーションを除き、これまではほぼこういった処理は行われていなかった。

・ツメ／アケ処理の説明画像入る

　しかし、W3C等での規格策定の進捗に合わせる形で2023年12月始めにGoogle Chromeに近日中に文字ツメ／アケ関連のプロパティが実装される予定とのアナウンスがあった（[参照](https://developer.chrome.com/blog/css-i18n-features?hl=ja)）。まだ規格策定の段階としてはWDであり、ようやく最初のブラウザ実装が出る程度の段階であるため、規格が確定してメジャーなブラウザ全てで使えるようになるにはしばらく時間はかかりそうだが、いずれは安定して使えるようになることを期待したい。  
　また、こういったW3Cの規格としての文字ツメ／アケ関連プロパティ実装の動きと並行する形で、各EPUBビューアで独自実装、強制適用という形で文字ツメ／アケ処理が行われるようになってきている状況がある。このため、このテストでは2023年12月時点での記録として各ビューアの状況をレポートすることとした。ただし上記のように正式なCSS規格の規格策定進展中という状態であるため、特に外部のブラウザエンジンをレンダリングに使用しているビューアでは将来的に挙動が変化する可能性があることは最初に注記しておく。なお、CSSの該当プロパティ、text-spacing-trim / text-autospace自体の先行実装を行っているVivliostyle Viewerはここではテストから除外した。  
　テストとしては各ビューアが「括弧類が行頭に来た場合に行頭に二分スペースが入るかどうか」「行中で約物が連続した場合にアキの自動ツメ処理を行うかどうか」「和欧文字間に自動でスペースを挿入する処理を行うかどうか」を観察した。

### 文字アケ・文字ツメの指定方法
こちらのテストは各ビューアのデフォルトの文字アケ・文字ツメの挙動を見るものであるため、特にCSSでの指定は行っていない。

### テスト結果

・表入る

「括弧類が行頭に来た場合に行頭に二分スペースが入るかどうか」のテストでも「OK」「NG」の表記を使っているが、こちらのテストで行頭二分下げの処理をすることが望ましいとする意図はないので留意されたい。単純な表示結果の区分として使っている。  
　「各OSで利用できるブラウザエンジンに依拠するアプリ」では、ツメ／アケの独自処理を行っているビューアは見当たらなかった。まだCSSでの正式規格化には至っていないので当然ではあるが、外部エンジンでレンダリング処理を行っている以上、将来的なOS等のアップデートに準じて対応が進む可能性はあるので注視しておきたい。  
　「独自レイアウトエンジンで動作するアプリ」では、以前からツメ／アケ処理を行っていたhonto、Kinoppy以外に、Kindle Previewer3での対応が目立った。これはつい数ヶ月前にWindows版／Mac版アプリのメジャーアップデート完了のアナウンスがあったことと符合するが、Windows版KindleとKindle Previerer3で和欧文字間のアケ処理の挙動に差が出ていることも気になる。Kindle Previerer3はiOS版Kindleとほぼ同じ挙動を示すという話があり、またMac版のKindleアプリはiOS版をベースに作られたらしいとの話もあるようなので、現状Windows版Kindleと他のもので挙動に差異があるということかもしれない。  
　Kindleは現在、全てのデバイスで外部EPUBデータを読み込んで販売時と同じように表示できるわけではないため（Send to Kindleで転送自体はできてもCSSが効かないなどの症状が出る）、テストファイルを用いての完全な検証はできないが、新旧のMac版Kindleアプリで明らかな挙動の違いが見られるため、最後に販売されている本の同一箇所のスクリーンショットを撮ったものを載せておく。左が旧Kindleアプリ（現在Kindle Classicというアプリ名に変わっている）、右が新Kindleアプリの表示画面になる。明らかに連続する約物のツメ処理が効いているのが見て取れる。

写真3-3入る

参照：「ティムール帝国」（講談社文庫メチエ）